{% extends 'base.html' %}
{% load lottery_extras %}

{% block title %}홈 - 복권 사이트{% endblock %}

{% block content %}
<!-- 欢迎横幅 -->
<div class="jumbotron bg-primary text-white rounded mb-4 p-5">
    <div class="container">
        <h1 class="display-4">복권 사이트에 오신 것을 환영합니다!</h1>
        <p class="lead">안전하고 공정하며 투명한 온라인 복권 플랫폼으로, 쉽게 참여하고 즐겁게 당첨되세요!</p>
        {% if not user.is_authenticated %}
        <a class="btn btn-light btn-lg" href="{% url 'accounts:register' %}" role="button">지금 가입</a>
        {% endif %}
    </div>
</div>

<!-- 彩票类型展示 -->
<div class="row mb-4">
    <div class="col-12">
        <h2 class="mb-3">인기 복권</h2>
    </div>
    {% for lottery_type in lottery_types %}
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ lottery_type.name }}</h5>
                <p class="card-text">{{ lottery_type.description }}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-primary font-weight-bold">₩{{ lottery_type.price }}</span>
                    <div>
                        <a href="{% url 'lottery:lottery_detail' lottery_type.id %}" class="btn btn-outline-primary btn-sm">상세</a>
                        {% if user.is_authenticated %}
                        <a href="{% url 'lottery:purchase_lottery' lottery_type.id %}" class="btn btn-primary btn-sm">구매</a>
                        {% else %}
                        <a href="{% url 'accounts:login' %}" class="btn btn-primary btn-sm">로그인 후 구매</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            현재 이용 가능한 복권 유형이 없습니다.
        </div>
    </div>
    {% endfor %}
</div>

<!-- 最新开奖结果 -->
<div class="row">
    <div class="col-12">
        <h2 class="mb-3">최신 추첨</h2>
        {% if recent_draws %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>복권 유형</th>
                        <th>회차</th>
                        <th>추첨 시간</th>
                        <th>당첨 번호</th>
                    </tr>
                </thead>
                <tbody>
                    {% for draw in recent_draws %}
                    <tr>
                        <td>{{ draw.lottery_type.name }}</td>
                        <td>{{ draw.draw_number }}</td>
                        <td>{{ draw.draw_date|date:"Y-m-d H:i" }}</td>
                        <td>
                            {% for number in draw.winning_numbers|split:"," %}
                            <span class="lottery-number winning-number">{{ number }}</span>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="text-center">
            <a href="{% url 'lottery:draw_results' %}" class="btn btn-outline-primary">더 많은 추첨 결과 보기</a>
        </div>
        {% else %}
        <div class="alert alert-info">
            현재 추첨 기록이 없습니다.
        </div>
        {% endif %}
    </div>
</div>

<!-- 统计信息 -->
{% if user.is_authenticated %}
<div class="row mt-4">
    <div class="col-12">
        <h3>내 통계</h3>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-primary">계정 잔액</h5>
                <h3 class="text-success">₩{{ user.userprofile.balance|default:"0.00" }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-info">총 소비</h5>
                <h3 class="text-warning">₩{{ user.userprofile.total_spent|default:"0.00" }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title text-success">총 당첨</h5>
                <h3 class="text-success">₩{{ user.userprofile.total_won|default:"0.00" }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">빠른 작업</h5>
                <a href="{% url 'accounts:recharge' %}" class="btn btn-primary btn-sm">충전</a>
                <a href="{% url 'lottery:check_winnings' %}" class="btn btn-success btn-sm">당첨 확인</a>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
